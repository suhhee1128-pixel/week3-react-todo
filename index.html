<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Todo ì•±</title>
   
    <!-- React CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      // ì»´í¬ë„ŒíŠ¸
      function FilterBar({ query, setQuery, filter, setFilter }) {
        return (
          <div className="flex flex-col md:flex-row items-center gap-2 mt-2">
            <input
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="ê²€ìƒ‰..."
              className="flex-1 px-3 py-2 border border-pink-300 rounded-lg outline-none focus:ring-2 focus:ring-pink-200"
            />
            <div className="flex gap-2 w-full md:w-auto">
              <button
                onClick={() => setFilter("all")}
                className={`px-3 py-2 border rounded-lg transition flex-1 md:flex-none ${
                  filter === "all" ? "bg-pink-500 text-white" : "bg-white text-gray-900 border-gray-300"
                }`}
              >
                ì „ì²´
              </button>
              <button
                onClick={() => setFilter("active")}
                className={`px-3 py-2 hover:bg-pink-100 hover:text-black border rounded-lg transition flex-1 md:flex-none ${
                  filter === "active" ? "bg-pink-500 text-white" : "bg-white text-gray-900 border-gray-300"
                }`}
              >
                ì§„í–‰ì¤‘
              </button>
              <button
                onClick={() => setFilter("completed")}
                className={`px-3 py-2 hover:bg-pink-100 hover:text-black border rounded-lg transition flex-1 md:flex-none ${
                  filter === "completed" ? "bg-pink-500 text-white" : "bg-white text-gray-900 border-gray-300"
                }`}
              >
                ì™„ë£Œ
              </button>
            </div>
          </div>
        );
      }

      function TodoInput({ text, setText, onAdd }) {
        return (
          <div className="flex flex-col md:flex-row items-center gap-2 my-3">
            <input
              value={text}
              onChange={(e) => setText(e.target.value)}
              onKeyDown={(e) => {
                if (e.isComposing || e.keyCode === 229) return;
                if (e.key === "Enter") onAdd();
              }}
              placeholder="ìƒˆ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..."
              className="flex-1 px-3 py-2 border border-pink-300 rounded-lg outline-none focus:ring-2 focus:ring-pink-200"
            />
            <button
              onClick={onAdd}
              className="w-full md:w-auto px-4 py-2 bg-pink-200 hover:bg-pink-400 text-black rounded-lg"
            >
              ì¶”ê°€
            </button>
          </div>
        );
      }

      function TodoItem({ todo, onToggle, onDelete }) {
        return (
          <li className="flex items-center justify-between py-2">
            <label className="flex items-center gap-2 flex-1">
              <input
                type="checkbox"
                checked={todo.completed}
                onChange={() => onToggle(todo.id)}
                className="accent-pink-500"
              />
              <span
                className={`text-gray-800 ${
                  todo.completed
                    ? "line-through text-gray-400 opacity-60"
                    : "no-underline text-gray-800 opacity-100"
                }`}
              >
                {todo.text}
              </span>
            </label>
            <button
              onClick={() => onDelete(todo.id)}
              className="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-1 rounded-lg ml-2"
            >
              ì‚­ì œ
            </button>
          </li>
        );
      }

      function TodoList({ items, onToggle, onDelete }) {
        return (
          <ul className="mt-2 pl-4 divide-y divide-gray-100">
            {items.length === 0 ? (
              <li className="text-gray-500">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì¶”ê°€í•´ë³´ì„¸ìš” ğŸ¯</li>
            ) : (
              items.map((todo) => (
                <TodoItem
                  key={todo.id}
                  todo={todo}
                  onToggle={onToggle}
                  onDelete={onDelete}
                />
              ))
            )}
          </ul>
        );
      }

      function TodoStats({ todos }) {
        const total = todos.length;
        const completed = todos.filter((t) => t.completed).length;
        const remaining = total - completed;
        return (
          <div className="mt-3 p-3 bg-white border border-gray-200 rounded-lg shadow-sm">
            <div className="flex gap-4">
              <div>ì „ì²´: <b>{total}</b></div>
              <div>ì™„ë£Œ: <b>{completed}</b></div>
              <div>ë‚¨ì€ ì¼: <b>{remaining}</b></div>
            </div>
          </div>
        );
      }

      // ë©”ì¸ TodoApp ì»´í¬ë„ŒíŠ¸
      function TodoApp() {
        // ìƒíƒœ ìƒì 
        const [todos, setTodos] = React.useState([]);  // ëª©ë¡
        const [text, setText] = React.useState("");    // ì…ë ¥ì°½ ê¸€ì
        const addTodo = () => {
          const t = text.trim();
          if (!t) return;
          const item = { id: Date.now(), text: t, completed: false };
          setTodos([...todos, item]); // ìƒˆ ë°°ì—´ë¡œ ì—…ë°ì´íŠ¸
          setText("");                // ì…ë ¥ì°½ ë¹„ìš°ê¸°
        };

        // ê²€ìƒ‰ì–´ ìƒíƒœ
        const [query, setQuery] = React.useState("");

        // í•„í„° ìƒíƒœ: 'all' 'active' 'completed'
        const [filter, setFilter] = React.useState("all");

        // 1: ê²€ìƒ‰ ì ìš©
        const bySearch = todos.filter(t =>
          t.text.toLowerCase().includes(query.toLowerCase())
        );

        // 2: í•„í„° ì ìš©
        const filtered = bySearch.filter(t => {
          if (filter === "active") return !t.completed;
          if (filter === "completed") return t.completed;
          return true; // 'all'
        });

        // í˜ì´ì§€ê°€ ì²˜ìŒ ì—´ë¦´ ë•Œ(localStorageì—ì„œ) ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        React.useEffect(() => {
          try {
            const raw = localStorage.getItem("react-todos");
            if (raw) setTodos(JSON.parse(raw));
          } catch (e) {
            console.warn("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
          }
        }, []); // ë¹ˆ ë°°ì—´: 'ì²˜ìŒ 1ë²ˆë§Œ' ì‹¤í–‰
        
        // todosê°€ ë°”ë€” ë•Œë§ˆë‹¤ ìë™ ì €ì¥
        React.useEffect(() => {
          try {
            localStorage.setItem("react-todos", JSON.stringify(todos));
          } catch (e) {
            console.warn("ì €ì¥ ì‹¤íŒ¨:", e);
          }
        }, [todos]); // todosê°€ ë°”ë€” ë•Œë§ˆë‹¤ ì‹¤í–‰

        // ì™„ë£Œ í† ê¸€: ì²´í¬í•˜ë©´ completed ê°’ì„ ë°˜ëŒ€ë¡œ ë°”ê¿”ì¤Œ
        function toggleTodo(id) {
          setTodos(todos.map(t => 
            t.id === id ? { ...t, completed: !t.completed } : t
          ));
        }

        // ì‚­ì œ: í•´ë‹¹ idê°€ ì•„ë‹Œ ê²ƒë§Œ ë‚¨ê¹€
        function deleteTodo(id) {
          setTodos(todos.filter(t => t.id !== id));
        }

        return (
            <div className="p-4 md:p-8 bg-white rounded-lg max-w-2xl mx-auto" 
                style={{boxShadow: '0 0px 5px 1px rgba(236, 72, 153, 0.3)'}}>
            <h1 className="text-2xl md:text-4xl font-bold mb-4 text-center">*Todo List</h1>

            {/* ê²€ìƒ‰ + í•„í„° */}
            <FilterBar query={query} setQuery={setQuery} filter={filter} setFilter={setFilter} />

            {/* ì…ë ¥ì°½ */}
            <TodoInput text={text} setText={setText} onAdd={addTodo} />
            
            {/* í•  ì¼ ëª©ë¡ */}
            <TodoList items={filtered} onToggle={toggleTodo} onDelete={deleteTodo} />

            {/* í†µê³„ ë°•ìŠ¤ */}
            <TodoStats todos={todos} />
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<TodoApp />);
    </script>
</body>
</html>